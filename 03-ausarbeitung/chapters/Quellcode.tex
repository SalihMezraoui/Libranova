\chapter{Quellcode}


\begin{lstlisting}[style=pseudocode, caption=Prozess des Auscheckens eines Buches im Frontend, label=renderButton(), breaklines=true]
	const checkoutButton = useMemo(() => {
		if (!props.isAuthenticated) {
			return (
			<Link to="/login" className="btn btn-success btn-lg w-100">
			{t("checkout.signIn")}
			</Link>
			);
		}
		
		if (!props.isCheckedOut && props.currentLoans < 5) {
			if (!props.book?.copiesInStock || props.book.copiesInStock <= 0) {
				return (
				<button
				className="btn btn-success btn-lg w-100 shadow-sm"
				disabled
				>
				{t("checkout.checkout")}
				</button>
				);
			}
			
			return (
			<button
			onClick={() => props.checkoutBook()}
			className="btn btn-success btn-lg w-100 shadow-sm"
			aria-label={t("checkout.checkout")}
			>
			{t("checkout.checkout")}
			</button>
			);
		}
		
		if (props.isCheckedOut) {
			return (
			<p className="text-success fw-semibold text-center">
			<i className="bi bi-check-circle-fill me-2"></i>
			{t("checkout.alreadyCheckedOut")}
			</p>
			);
		}
		
		return (
		<p className="text-danger fw-semibold text-center">
		<i className="bi bi-exclamation-triangle-fill me-2"></i>
		{t("checkout.maxReached")}
		</p>
		);
	}, [
	props.isAuthenticated,
	props.isCheckedOut,
	props.currentLoans,
	props.checkoutBook,
	t,
	]);
\end{lstlisting}







\begin{lstlisting}[style=pseudocode, caption=Die Geschäftslogik der Rückgabe eines Buches im Backend, label=returnBook().java, breaklines=true]
	public void returnBook(String userEmail, Long bookId) throws ParseException {
		Book book = bookRepository.findById(bookId)
		.orElseThrow(() -> new BookNotAvailableException("Book with ID " + bookId + " is not available."));
		
		Checkout checkout = checkoutRepository.findByBookIdAndUserEmail(bookId, userEmail);
		if (checkout == null) {
			throw new BookNotAvailableException("No active checkout found for book with ID " + bookId + ".");
		}
		
		book.setCopiesInStock(book.getCopiesInStock() + 1);
		bookRepository.save(book);
		
		LocalDate dueDate = LocalDate.parse(checkout.getReturnDate());
		LocalDate today = LocalDate.now();
		long daysOverdue = ChronoUnit.DAYS.between(dueDate, today);
		
		if (daysOverdue > 0) {
			Payment payment = paymentRepository.findPaymentsByUserEmail(userEmail);
			if (payment == null) {
				payment = Payment.builder()
				.userEmail(userEmail)
				.amount(0.0)
				.build();
			}
			
			payment.setAmount(payment.getAmount() + daysOverdue * 2);
			paymentRepository.save(payment);
		}
		
		checkoutRepository.deleteById(checkout.getId());
		
		History history = History.builder()
		.userEmail(userEmail)
		.checkoutDate(checkout.getCheckoutDate())
		.returnedDate(LocalDate.now().toString())
		.title(book.getTitle())
		.author(book.getAuthor())
		.overview(book.getOverview())
		.image(book.getImage())
		.build();
		
		historyRepository.save(history);
	}
\end{lstlisting}